<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pump Track Timer</title>

<style>
* {
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: #1e1f22;
  color: #f2f2f2;
  height: 100vh;
  overflow: hidden;
}

.screen {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  padding: 1rem;
  opacity: 0;
  pointer-events: none;
  transform: scale(1.05);
  transition: 0.4s;
}

.screen.active {
  opacity: 1;
  pointer-events: auto;
  transform: scale(1);
}

h1 {
  text-align: center;
  font-weight: 600;
}

button {
  background: #2b2d31;
  color: #f2f2f2;
  border: none;
  border-radius: 6px;
  padding: 1.2rem;
  font-size: 1.3rem;
  font-weight: 600;
}

button:active {
  transform: scale(0.98);
}

.main-buttons {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.small-btn {
  padding: 0.7rem;
  font-size: 1rem;
}

.back {
  position: absolute;
  top: 0.75rem;
  left: 0.75rem;
  width: 44px;
  height: 44px;
  border-radius: 50%;
}

.center {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
}

.timer {
  font-family: monospace;
  font-size: 4.5rem;
}

.big-text {
  font-size: 3.5rem;
  font-weight: 700;
}

.bottom {
  display: flex;
  gap: 0.5rem;
}

.leaderboard {
  overflow-y: auto;
  margin-top: 1rem;
}

.row {
  display: grid;
  grid-template-columns: 1fr 2fr;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.row div {
  background: #2b2d31;
  padding: 0.6rem;
  border-radius: 4px;
}
</style>
</head>

<body>

<!-- HOME -->
<div class="screen active" id="home">
  <h1>Pump Track Timer</h1>
  <div class="main-buttons">
    <button onclick="startSession()">⏱ Start Session</button>
    <button onclick="openScreen('leaderboard')">Leaderboard</button>
    <button onclick="openScreen('settings')" class="small-btn">⚙ Settings</button>
  </div>
</div>

<!-- SESSION -->
<div class="screen" id="session">
  <button class="back" onclick="goHome()">←</button>
  <div class="center" id="sessionText">
    <div class="big-text">Waiting for rider</div>
  </div>
  <div class="center timer" id="timer" style="display:none">00:00.00</div>
  <div class="bottom" id="sessionButtons" style="display:none">
    <button onclick="enterName()">Enter name</button>
    <button onclick="goHome()">Reset</button>
  </div>
</div>

<!-- LEADERBOARD -->
<div class="screen" id="leaderboard">
  <button class="back" onclick="goHome()">←</button>
  <h1>Leaderboard</h1>
  <div class="leaderboard" id="board"></div>
</div>

<!-- SETTINGS -->
<div class="screen" id="settings">
  <button class="back" onclick="goHome()">←</button>
  <h1>Settings</h1>
  <p style="text-align:center">
    Ultrasonic Distance: <span id="dist">50</span>cm
  </p>
  <input type="range" min="20" max="200" step="10" value="50"
    oninput="document.getElementById('dist').textContent=this.value">
</div>

<script>
let leaderboard = [];
let timerInterval;
let startTime;
let finalTime;

function openScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function goHome() {
  clearInterval(timerInterval);
  openScreen('home');
}

function startSession() {
  openScreen('session');
  document.getElementById('sessionText').innerHTML = '<div class="big-text">Waiting for rider</div>';
  document.getElementById('timer').style.display = 'none';
  document.getElementById('sessionButtons').style.display = 'none';

  setTimeout(() => {
    document.getElementById('sessionText').innerHTML = '<div class="big-text">LAP STARTED</div>';
    startTime = Date.now();

    timerInterval = setInterval(() => {
      const ms = Date.now() - startTime;
      document.getElementById('timer').style.display = 'block';
      document.getElementById('timer').textContent = format(ms);
    }, 50);

    const stopAfter = 6000 + Math.random() * 4000;
    setTimeout(stopTimer, stopAfter);
  }, 3000);
}

function stopTimer() {
  clearInterval(timerInterval);
  finalTime = Date.now() - startTime;
  document.getElementById('sessionText').innerHTML = '<div class="big-text">Final Time</div>';
  document.getElementById('sessionButtons').style.display = 'flex';
}

function format(ms) {
  const s = Math.floor(ms / 1000);
  const m = Math.floor(s / 60);
  return `${String(m).padStart(2,'0')}:${String(s%60).padStart(2,'0')}.${String(Math.floor(ms%1000/10)).padStart(2,'0')}`;
}

function enterName() {
  const name = prompt("Enter rider name");
  if (!name) return;

  const existing = leaderboard.find(e => e.name === name);
  if (!existing || finalTime < existing.time) {
    if (existing) existing.time = finalTime;
    else leaderboard.push({name, time: finalTime});
  }

  leaderboard.sort((a,b) => a.time - b.time);
  renderBoard();
}

function renderBoard() {
  const board = document.getElementById('board');
  board.innerHTML = '';
  leaderboard.forEach(e => {
    board.innerHTML += `
      <div class="row">
        <div>${e.name}</div>
        <div>${format(e.time)}</div>
      </div>`;
  });
}
</script>

</body>
</html>
